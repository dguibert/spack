spack:
  #upstreams:
  #  slash-software:
  #    install_tree: /software/spack/v0.13.2-9600-g5f36801aa7-2925a5e/software/spack/opt/spack
  include:
  - packages-spartan-x86_64.yaml
  config:
    install_missing_compilers: true
    source_cache: /software/spack/mirror
  #concretization: separately
  concretizer:
    unify: when_possible
  mirrors:
    software-mirror: file://software/spack/mirror
  modules:
    default:
      lmod:
        core_compilers:
        - gcc@8.4.1
  packages:
    all:
      target: [x86_64, aarch64]
      compiler: [gcc@8.4.1]
    nvhpc:
      variants:
      - ~mpi
      - ~blas
      - ~lapack
    aocc:
      variants:
      - +license-agreed
    openmpi:
      variants:
      - fabrics='knem,ucx' # comma not handle
      - +legacylaunchers
      - +pmix
      - schedulers=slurm
      - +thread_multiple
  definitions:
  - compilers:
    - aocc@3.2.0
    - gcc@8.4.1
    - gcc@10.2.0
    - gcc@11.2.0
    - gcc@11.2.0+nvptx
    - intel-oneapi-compilers@2022.0.1%gcc@8.4.1
    - nvhpc@21.11
    - nvhpc@21.7
    - nvhpc@21.9
    - nvhpc@22.1
  - compiler_specs:
    - aocc@3.2.0
    - gcc@10.2.0
    - gcc@11.2.0
    - gcc@11.2.0+nvptx
    - oneapi@2022.0.0
    - nvhpc@21.11
    - nvhpc@21.7
    - nvhpc@21.9
    - nvhpc@22.1
  - mpis_with_compiler_specs:
    - gcc@10.2.0 ^openmpi fabrics='knem,ucx' %gcc@10.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - gcc@11.2.0 ^openmpi fabrics='knem,ucx' %gcc@11.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - aocc@3.2.0 ^openmpi fabrics='knem,ucx' %aocc@3.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - nvhpc@21.7 ^openmpi fabrics='knem,ucx' %nvhpc@21.7 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - nvhpc@21.9 ^openmpi fabrics='knem,ucx' %nvhpc@21.9 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - nvhpc@21.11 ^openmpi fabrics='knem,ucx' %nvhpc@21.11 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - nvhpc@22.1 ^openmpi fabrics='knem,ucx' %nvhpc@22.1 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - oneapi@2022.0.1 ^intel-oneapi-mpi@2021.5.0%gcc@8.4.1
  - mpis:
    - openmpi fabrics='knem,ucx' %gcc@10.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %gcc@11.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %aocc@3.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %nvhpc@21.7 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %nvhpc@21.9 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %nvhpc@21.11 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - openmpi fabrics='knem,ucx' %nvhpc@22.1 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1
      ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1
      ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
      ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
    - intel-oneapi-mpi@2021.5.0%gcc@8.4.1
  - mpi_packages:
    - osu-micro-benchmarks
    - netcdf-fortran ^hdf5+fortran+mpi ^netcdf-c+mpi
  - seq_packages: []
    #- netcdf-fortran ^netcdf-c~mpi ^hdf5+fortran~mpi
  specs:
  - binutils
  - cmake@3.21.4%gcc@8.4.1
  - environment-modules
  - git+tcltk
  - htop ^python+ssl%gcc@8.4.1
  - intel-oneapi-advisor@2022.0.0
  - intel-oneapi-inspector@2022.0.0
  - intel-oneapi-mkl@2022.0.1
  - intel-oneapi-tbb@2021.5.0
  - intel-oneapi-vtune@2022.0.0
  - likwid@5.0.1+accessdaemon%gcc ^lua%gcc ^perl%gcc ^unzip%gcc
  - likwid+accessdaemon%gcc ^lua%gcc ^perl%gcc ^unzip%gcc
  - lmod ^lua-luaposix@33.4.0
  - $compilers
  - $mpis
  - matrix:
    - [osu-micro-benchmarks]
    - [$%mpis_with_compiler_specs]
  - netcdf-fortran%gcc@10.2.0 ^netcdf-c%gcc ^hdf5%gcc ^openmpi fabrics='knem,ucx'
    %gcc@10.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1 ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
  - netcdf-fortran%nvhpc@21.7 ^netcdf-c%nvhpc ^hdf5%nvhpc ^openmpi fabrics='knem,ucx'
    %nvhpc@21.7 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1 ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
  - netcdf-fortran%nvhpc@21.9 ^netcdf-c%nvhpc@21.9 ^hdf5%nvhpc@21.9 ^openmpi fabrics='knem,ucx'
    %nvhpc@21.9 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1 ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
  - netcdf-fortran%nvhpc@21.11 ^netcdf-c%nvhpc@21.11 ^hdf5%nvhpc@21.11 ^openmpi fabrics='knem,ucx'
    %nvhpc@21.11 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1 ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
  - netcdf-fortran%nvhpc@22.1 ^netcdf-c%nvhpc@22.1 ^hdf5%nvhpc@22.1 ^openmpi fabrics='knem,ucx'
    %nvhpc@22.1 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1 ^perl%gcc@8.4.1 ^python+ssl%gcc@8.4.1
# FAILS to build
#  - netcdf-fortran%aocc@3.2.0 ^netcdf-c%aocc ^hdf5%aocc ^openmpi fabrics='knem,ucx'
#    %aocc@3.2.0 ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1 ^hwloc%gcc@8.4.1
#    ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1 ^numactl%gcc@8.4.1
#    ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
  view: false
  compilers:
  - compiler:
      spec: gcc@8.4.1
      paths:
        cc: /usr/bin/gcc
        cxx: /usr/bin/g++
        f77: /usr/bin/gfortran
        fc: /usr/bin/gfortran
      flags: {}
      operating_system: rhel8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: nvhpc@21.7
      paths:
        cc: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel8-x86_64/gcc-8.4.1/nvhpc-21.7-6fbexyxptapmwsdtemsnkt3t6stxllxy/Linux_x86_64/21.7/compilers/bin/nvc
        cxx: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel8-x86_64/gcc-8.4.1/nvhpc-21.7-6fbexyxptapmwsdtemsnkt3t6stxllxy/Linux_x86_64/21.7/compilers/bin/nvc++
        f77: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel8-x86_64/gcc-8.4.1/nvhpc-21.7-6fbexyxptapmwsdtemsnkt3t6stxllxy/Linux_x86_64/21.7/compilers/bin/nvfortran
        fc: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel8-x86_64/gcc-8.4.1/nvhpc-21.7-6fbexyxptapmwsdtemsnkt3t6stxllxy/Linux_x86_64/21.7/compilers/bin/nvfortran
      flags: {}
      operating_system: rhel8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: aocc@3.2.0
      paths:
        cc: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/aocc-3.2.0-64oawcm2ov7tbwt7ebzjgdr5avnyloap/bin/clang
        cxx: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/aocc-3.2.0-64oawcm2ov7tbwt7ebzjgdr5avnyloap/bin/clang++
        f77: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/aocc-3.2.0-64oawcm2ov7tbwt7ebzjgdr5avnyloap/bin/flang
        fc: /home_nfs/bguibertd/software-cepp-spack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/aocc-3.2.0-64oawcm2ov7tbwt7ebzjgdr5avnyloap/bin/flang
      flags:
        cflags: null
        cxxflags: null
        fflags: null
      operating_system: rhel7
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
