spack:
  #upstreams:
  #  slash-software:
  #    install_tree: /software/spack/v0.13.2-9600-g5f36801aa7-2925a5e/software/spack/opt/spack
  config:
    install_missing_compilers: true
  mirrors:
    software-mirror: file://software/spack/mirror
  modules:
      lmod:
        core_compilers:
        - gcc@8.4.1
  packages:
    ucx:
      variants:
      - +cm
      - +cma
      - +dc
      - +dm
      - +ib-hw-tm
      - +knem
      - +mlx5-dv
      - +rc
      - +ud
      - +mofed
    all:
      target: [x86_64, aarch64]
      compiler: [gcc@8.4.1]
    openmpi:
      variants:
      - fabrics=knem,ucx # comma not handle
      - +legacylaunchers
      - +pmix
      - schedulers=slurm
      - +thread_multiple
        #compiler:
        #- gcc@11.2.0   # https://github.com/spack/spack/issues/21660, https://github.com/spack/spack/issues/1371
  specs:
  - binutils
  - cmake%gcc
  - environment-modules
  - gcc@11.2.0
  - lmod
  - openmpi fabrics=knem,ucx %gcc@11.2.0
    ^ucx%gcc@11.2.0
    ^autoconf%gcc@8.4.1 ^automake%gcc@8.4.1 ^cmake%gcc@8.4.1
    ^hwloc%gcc@8.4.1 ^libevent%gcc@8.4.1 ^libtool%gcc@8.4.1 ^libxml2%gcc@8.4.1 ^m4%gcc@8.4.1
    ^numactl%gcc@8.4.1 ^openssh%gcc@8.4.1 ^rdma-core%gcc@8.4.1 ^zlib%gcc@8.4.1
  view: false
  concretization: separately
